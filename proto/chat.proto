syntax = "proto3";
package chat;
option go_package = "./chatpb";

message ChatRequest { string user_id = 1; string text = 2; }
message ChatResponse {
  string reply = 1;

  // 新增：本次调用的真实 token 用量
  int32 prompt_tokens    = 2;
  int32 completion_tokens= 3;
  int32 total_tokens     = 4;
}


service LLMService {
  rpc Generate(ChatRequest) returns (ChatResponse);
}

/******** 新增：Filter ********/
message FilterRequest { string text = 1; }
message FilterReply { bool allowed = 1; string cleaned = 2; }

service FilterService {
  rpc Filter(FilterRequest) returns (FilterReply);
}
/******** 新增：Token ********/
message TokenRequest { string user_id = 1; int32 tokens = 2; }
message TokenReply { bool allowed = 1; int64 remaining = 2; }

service TokenService {
  rpc CheckAndInc(TokenRequest) returns (TokenReply);
}
